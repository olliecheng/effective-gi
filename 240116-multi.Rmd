---
title: "240116-multi"
author: "Oliver Cheng"
date: "2024-01-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
source("plots.R")
source("calculations.R")
```

```{r}
source("model-multistrain.R")

state <- c(S.AB = 99999,  # susceptible to both strains A and B
           S.A  = 0,      # susceptible to A, immune to B
           S.B  = 0,      # susceptible to B, immune to A
           
           E.A1 = 1,      # exposed to A, sus. B
           E.B1 = 0,      # exposed to B, sus. A
           
           E.A2 = 0,      # exposed to A, imm. B
           E.B2 = 0,      # exposed to B, imm. A
           
           I.A1 = 0,      # infectious for A, sus. B
           I.B1 = 0,      # infectious for B, sus. A
           
           I.A2 = 0,      # infectious for A, imm. B
           I.B2 = 0,      # infectious for B, imm. A
           
           R.A  = 0,      # removed from A, temporarily immune to B
           R.B  = 0,      # removed from B, temporarily immune to A
           R.AB = 0      # removed from both A and B
           )

events <- data.frame(
             var = c("I.B1"),
             time = c(70) ,
             value = c(100),
             method = c("replace")
          )

A_params <- function(t) {
  list(beta = 0.17857 * 1.8, sigma = 0.4, gamma = 0.17857, omega = 1/10, label="BA.1")
}

B_params <- function(t) {
  list(beta = 0.17857 * 2, sigma = 0.4, gamma = 0.17857, omega = 1/10, label="BA.2")
}

# with events
parameters <- list(A = A_params, B = B_params, N = 100000, x = 0.5, events = events)

# no events
# parameters <- list(A = A_params, B = B_params, N = 100000, x = 0.5)

r <- simulate_two_seir(state, parameters, 0, 300)
```

```{r fig.width=10, fig.height=6}
source("plots.R")
plot_multiple_SEIR(r, "exploded")

# ggplot(r$data, aes(x=time, y=S.A2)) + geom_line()

# plot_multiple_SEIR(r, "combined")
# plot_multiple_SEIR(r, "incidence")
```

```{r}

times <- seq(0, 100, by=0.1)
gt <- data.frame(time = times)

gt$A.basic <- basic_mean_gt(r$strains$A)

gt$A.fwd <- sapply(times, \(x) forward_mean_gt(r$strains$A, x))
gt$A.back <- sapply(times, \(x) backward_mean_gt(r$strains$A, x))
```
